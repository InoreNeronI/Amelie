var e={};e=ReactDOM;var t={};t=React;var r={};r=d3;const s=(0,t.createClass)({componentDidMount(){let t=r.select((0,e.findDOMNode)(this)).append("svg").attr("width",this.state.size[0]).attr("height",this.state.size[1]).append("g");(0,e.findDOMNode)(this).style.width=this.state.size[0]+"px",(0,e.findDOMNode)(this).style.height=this.state.size[1]+"px",this.setState({d3:t,colours:new function(){let e=[];return t=>{if(!e[t]){let r=Math.round(255*Math.random());e[t]="rgb("+r+", "+r+", "+r+")"}return e[t]}}})},componentWillReceiveProps(e){0===this.state.circles.length&&e.fftSize&&this.setState({circles:this.createCircles(e.fftSize)})},createCircles(e){let t=[];for(let r=0;r<e;r++)t.push(this.state.d3.append("circle"));return t},getInitialState:()=>({circles:[],colours:()=>{},size:[400,400]}),renderCircles(e){if(0===this.state.circles.length)return;let t=this.state.colours,r=this.computeCxCy(),s=0,i=e.length;for(;s<i;s++)this.state.circles[s].attr("cx",r.cx).attr("cy",r.cy).attr("r",e[s]/2.5).style("fill",t(s));this.renderSplodges(e)},computeCxCy(){return{cx:this.state.size[0]-110,cy:this.state.size[1]-110}},renderSplodges(e){let t=this.computeCxCy(),r=e.length,s=Array.prototype.slice.call(e).splice(r-(r-r/4)).reduce((e,t)=>e+t,0);0!==s&&(t.cx+=190*Math.random()-95,t.cy+=190*Math.random()-95,this.state.d3.append("circle").attr("cx",t.cx).attr("cy",t.cy).attr("r",s/40).style("fill",this.getRandomColour()).transition().attr("r",0).duration(500).remove())},getRandomColour:()=>"#"+Math.floor(16777215*Math.random()).toString(16),positionDOMElement(t){(0,e.findDOMNode)(this).style.left=t.x-this.state.size[0]/2+"px",(0,e.findDOMNode)(this).style.top=t.y-this.state.size[1]/2+"px"},render(){return this.props.frequencyData&&(this.renderCircles(this.props.frequencyData),this.state.d3&&this.positionDOMElement(this.props.cursor)),React.createElement("div",{className:"canvas-container"})}}),i=(0,t.createClass)({componentWillReceiveProps(e){e.analyser&&this.analyseAudioStream(e.analyser)},getInitialState:()=>({cursor:{x:0,y:0},frequencyData:[]}),analyseAudioStream(e){(requestAnimationFrame||mozRequestAnimationFrame||webkitRequestAnimationFrame)(()=>{this.analyseAudioStream(e)});let t=new Uint8Array(e.frequencyBinCount);e.getByteFrequencyData(t),this.setState({frequencyData:t,fftSize:e.fftSize})},setCursorPosition(e){this.setState({cursor:{x:e.clientX,y:e.clientY}})},render(){return React.createElement("section",{className:"visualizer",onMouseMove:this.setCursorPosition},React.createElement(s,{frequencyData:this.state.frequencyData,cursor:this.state.cursor,fftSize:this.state.fftSize}))}}),o=(0,t.createClass)({componentDidMount(){this.getElement().addEventListener("play",this.configureAudioContext)},getInitialState:()=>({analyser:null}),getElement:()=>(0,e.findDOMNode)(document.querySelector("audio")),configureAudioAnalyser(){let e=window.context.createAnalyser();window.source.connect(e),e.connect(context.destination),e.fftSize=128,this.setState({analyser:e})},configureAudioContext(){if(void 0===window.context){let e=AudioContext||mozAudioContext||webkitAudioContext||oAudioContext||msAudioContext;if(!e)throw"AudioContext API unavailable in current browser. Please try another!";window.context=new e,window.source=context.createMediaElementSource(this.getElement())}this.configureAudioAnalyser()},render(){return React.createElement("section",{className:"main"},React.createElement("audio",{crossOrigin:"anonymous"},React.createElement("source",{src:this.props.audio})),React.createElement(i,{analyser:this.state.analyser}))}}),n=document.querySelector("#root");(0,e.render)(React.createElement(o,{audio:n.getAttribute("data-audio")}),n);const a=document.querySelector("audio"),c=document.querySelector(".player");a.addEventListener("loadeddata",()=>{c.querySelector(".time .length").textContent=window.getTimeCodeFromNum(a.duration);let e=a.querySelector("source").src;c.querySelector(".name").textContent=window.htmlDecode(e.substr(e.lastIndexOf("/")+1)),a.volume=.75},!1);const l=c.querySelector(".timeline");l.addEventListener("click",e=>{let t=window.getComputedStyle(l).width;a.currentTime=e.offsetX/parseInt(t)*a.duration},!1);const d=c.querySelector(".controls .volume-slider");d.addEventListener("click",e=>{let t=window.getComputedStyle(d).width,r=e.offsetX/parseInt(t);a.volume=r,c.querySelector(".controls .volume-percentage").style.width=100*r+"%"},!1),setInterval(()=>{c.querySelector(".progress").style.width=a.currentTime/a.duration*100+"%",c.querySelector(".time .current").textContent=window.getTimeCodeFromNum(a.currentTime)},500);const u=c.querySelector(".controls .toggle-play");u.addEventListener("click",()=>{a.paused?(u.classList.remove("play"),u.classList.add("pause"),a.play()):(u.classList.remove("pause"),u.classList.add("play"),a.pause())},!1),a.addEventListener("ended",()=>{u.classList.remove("pause"),u.classList.add("play")},!1),a.addEventListener("play",()=>{u.classList.remove("play"),u.classList.add("pause")},!1),c.querySelector(".volume-button").addEventListener("click",()=>{let e=c.querySelector(".volume-container .volume");a.muted=!a.muted,a.muted?(e.classList.remove("icono-volumeMedium"),e.classList.add("icono-volumeMute")):(e.classList.add("icono-volumeMedium"),e.classList.remove("icono-volumeMute"))}),window.getTimeCodeFromNum=e=>new Date(1e3*parseInt(e)).toISOString().slice(11,19).replace(/00:/g,""),window.htmlDecode=e=>{let t=document.createElement("textarea");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue.replaceAll("%20"," ")};