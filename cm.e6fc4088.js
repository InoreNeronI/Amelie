!function(){function e(e){return e&&e.__esModule?e.default:e}var t={};t=ReactDOM;var r={};r=React;var s={};s=d3;let i=e(r).createClass({componentDidMount(){let r=e(s).select((0,t.findDOMNode)(this)).append("svg").attr("width",this.state.size[0]).attr("height",this.state.size[1]).append("g");(0,t.findDOMNode)(this).style.width=this.state.size[0]+"px",(0,t.findDOMNode)(this).style.height=this.state.size[1]+"px",this.setState({d3:r,colours:new function(){let e=[];return t=>{if(!e[t]){let r=Math.round(255*Math.random());e[t]="rgb("+r+", "+r+", "+r+")"}return e[t]}}})},componentWillReceiveProps(e){0===this.state.circles.length&&e.fftSize&&this.setState({circles:this.createCircles(e.fftSize)})},createCircles(e){let t=[];for(let r=0;r<e;r++)t.push(this.state.d3.append("circle"));return t},getInitialState:()=>({circles:[],colours:()=>{},size:[400,400]}),renderCircles(e){if(0===this.state.circles.length)return;let t=this.state.colours,r=this.computeCxCy(),s=0,i=e.length;for(;s<i;s++)this.state.circles[s].attr("cx",r.cx).attr("cy",r.cy).attr("r",e[s]/2.5).style("fill",t(s));this.renderSplodges(e)},computeCxCy(){return{cx:this.state.size[0]-110,cy:this.state.size[1]-110}},renderSplodges(e){let t=this.computeCxCy(),r=e.length,s=Array.prototype.slice.call(e).splice(r-(r-r/4)).reduce((e,t)=>e+t,0);0!==s&&(t.cx+=190*Math.random()-95,t.cy+=190*Math.random()-95,this.state.d3.append("circle").attr("cx",t.cx).attr("cy",t.cy).attr("r",s/40).style("fill",this.getRandomColour()).transition().attr("r",0).duration(500).remove())},getRandomColour:()=>"#"+Math.floor(16777215*Math.random()).toString(16),positionDOMElement(e){(0,t.findDOMNode)(this).style.left=e.x-this.state.size[0]/2+"px",(0,t.findDOMNode)(this).style.top=e.y-this.state.size[1]/2+"px"},render(){return this.props.frequencyData&&(this.renderCircles(this.props.frequencyData),this.state.d3&&this.positionDOMElement(this.props.cursor)),e(r).createElement("div",{className:"canvas-container"})},displayName:"Canvas"}),a=e(r).createClass({componentWillReceiveProps(e){e.analyser&&this.analyseAudioStream(e.analyser)},getInitialState:()=>({cursor:{x:0,y:0},frequencyData:[]}),analyseAudioStream(e){(requestAnimationFrame||mozRequestAnimationFrame||webkitRequestAnimationFrame)(()=>{this.analyseAudioStream(e)});let t=new Uint8Array(e.frequencyBinCount);e.getByteFrequencyData(t),this.setState({frequencyData:t,fftSize:e.fftSize})},setCursorPosition(e){this.setState({cursor:{x:e.clientX,y:e.clientY}})},render(){return e(r).createElement("section",{className:"visualizer",onMouseMove:this.setCursorPosition},e(r).createElement(i,{frequencyData:this.state.frequencyData,cursor:this.state.cursor,fftSize:this.state.fftSize}))},displayName:"Visualizer"}),n=e(r).createClass({componentDidMount(){this.getElement().addEventListener("play",this.configureAudioContext)},getInitialState:()=>({analyser:null}),getElement:()=>(0,t.findDOMNode)(document.querySelector("audio")),configureAudioAnalyser(){let e=window.context.createAnalyser();window.source.connect(e),e.connect(context.destination),e.fftSize=128,this.setState({analyser:e})},configureAudioContext(){if(void 0===window.context){let e=AudioContext||mozAudioContext||webkitAudioContext||oAudioContext||msAudioContext;if(!e)throw"AudioContext API unavailable in current browser. Please try another!";window.context=new e,window.source=context.createMediaElementSource(this.getElement())}this.configureAudioAnalyser()},render(){return e(r).createElement("section",{className:"main"},e(r).createElement("audio",{crossOrigin:"anonymous"},e(r).createElement("source",{src:this.props.audio})),e(r).createElement(a,{analyser:this.state.analyser}))},displayName:"Audio"}),o=document.querySelector("#root");(0,t.render)(React.createElement(n,{audio:o.getAttribute("data-audio")}),o);let l=document.querySelector("audio"),c=document.querySelector(".player");l.addEventListener("loadeddata",()=>{c.querySelector(".time .length").textContent=window.getTimeCodeFromNum(l.duration);let e=l.querySelector("source").src;c.querySelector(".name").textContent=window.htmlDecode(e.substr(e.lastIndexOf("/")+1)),l.volume=.75},!1);let d=c.querySelector(".timeline");d.addEventListener("click",e=>{let t=window.getComputedStyle(d).width,r=e.offsetX/parseInt(t)*l.duration;l.currentTime=r},!1);let u=c.querySelector(".controls .volume-slider");u.addEventListener("click",e=>{let t=window.getComputedStyle(u).width,r=e.offsetX/parseInt(t);l.volume=r,c.querySelector(".controls .volume-percentage").style.width=100*r+"%"},!1),setInterval(()=>{c.querySelector(".progress").style.width=l.currentTime/l.duration*100+"%",c.querySelector(".time .current").textContent=window.getTimeCodeFromNum(l.currentTime)},500);let m=c.querySelector(".controls .toggle-play");m.addEventListener("click",()=>{l.paused?(m.classList.remove("play"),m.classList.add("pause"),l.play()):(m.classList.remove("pause"),m.classList.add("play"),l.pause())},!1),l.addEventListener("ended",()=>{m.classList.remove("pause"),m.classList.add("play")},!1),l.addEventListener("play",()=>{m.classList.remove("play"),m.classList.add("pause")},!1),c.querySelector(".volume-button").addEventListener("click",()=>{let e=c.querySelector(".volume-container .volume");l.muted=!l.muted,l.muted?(e.classList.remove("icono-volumeMedium"),e.classList.add("icono-volumeMute")):(e.classList.add("icono-volumeMedium"),e.classList.remove("icono-volumeMute"))}),window.getTimeCodeFromNum=e=>{let t=parseInt(e),r=parseInt(t/60);t-=60*r;let s=parseInt(r/60);return(r-=60*s,0===s)?`${r}:${String(t%60).padStart(2,0)}`:`${String(s).padStart(2,0)}:${r}:${String(t%60).padStart(2,0)}`},window.htmlDecode=e=>{let t=document.createElement("textarea");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue.replaceAll("%20"," ")}}();