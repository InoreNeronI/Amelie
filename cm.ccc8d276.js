!function(){function e(e){return e&&e.__esModule?e.default:e}var t={};t=React;var r={};r=d3;let s=e(t).createClass({componentDidMount(){let t=e(r).select(this.getDOMNode()).append("svg").attr("width",this.state.size[0]).attr("height",this.state.size[1]).append("g");this.getDOMNode().style.width=this.state.size[0]+"px",this.getDOMNode().style.height=this.state.size[1]+"px",this.setState({d3:t,colours:new function(){let e=[];return t=>{if(!e[t]){let r=Math.round(255*Math.random());e[t]="rgb("+r+", "+r+", "+r+")"}return e[t]}}})},componentWillReceiveProps(e){0===this.state.circles.length&&e.fftSize&&this.setState({circles:this.createCircles(e.fftSize)})},createCircles(e){let t=[];for(let r=0;r<e;r++)t.push(this.state.d3.append("circle"));return t},getInitialState:()=>({circles:[],colours:()=>{},size:[400,400]}),renderCircles(e){if(0===this.state.circles.length)return;let t=this.state.colours,r=this.computeCxCy(),s=0,i=e.length;for(;s<i;s++)this.state.circles[s].attr("cx",r.cx).attr("cy",r.cy).attr("r",e[s]/2.5).style("fill",t(s));this.renderSplodges(e)},computeCxCy(){return{cx:this.state.size[0]-110,cy:this.state.size[1]-110}},renderSplodges(e){let t=this.computeCxCy(),r=e.length,s=Array.prototype.slice.call(e).splice(r-(r-r/4)).reduce((e,t)=>e+t,0);0!==s&&(t.cx+=190*Math.random()-95,t.cy+=190*Math.random()-95,this.state.d3.append("circle").attr("cx",t.cx).attr("cy",t.cy).attr("r",s/40).style("fill",this.getRandomColour()).transition().attr("r",0).duration(500).remove())},getRandomColour:()=>"#"+Math.floor(16777215*Math.random()).toString(16),positionDOMElement(e){this.getDOMNode().style.left=e.x-this.state.size[0]/2+"px",this.getDOMNode().style.top=e.y-this.state.size[1]/2+"px"},render(){return this.props.frequencyData&&(this.renderCircles(this.props.frequencyData),this.state.d3&&this.positionDOMElement(this.props.cursor)),e(t).createElement("div",{className:"canvas-container"})},displayName:"Canvas"}),i=e(t).createClass({componentWillReceiveProps(e){e.analyser&&this.analyseAudioStream(e.analyser)},getInitialState:()=>({cursor:{x:0,y:0},frequencyData:[]}),analyseAudioStream(e){(requestAnimationFrame||mozRequestAnimationFrame||webkitRequestAnimationFrame)(()=>{this.analyseAudioStream(e)});let t=new Uint8Array(e.frequencyBinCount);e.getByteFrequencyData(t),this.setState({frequencyData:t,fftSize:e.fftSize})},setCursorPosition(e){this.setState({cursor:{x:e.clientX,y:e.clientY}})},render(){return e(t).createElement("section",{className:"visualizer",onMouseMove:this.setCursorPosition},e(t).createElement(s,{frequencyData:this.state.frequencyData,cursor:this.state.cursor,fftSize:this.state.fftSize}))},displayName:"Visualizer"}),a=e(t).createClass({componentDidMount(){this.getElement().addEventListener("play",this.configureAudioContext)},getInitialState:()=>({analyser:null}),getElement(){return this.getDOMNode().querySelector("audio")},configureAudioAnalyser(){let e=window.context.createAnalyser();window.source.connect(e),e.connect(context.destination),e.fftSize=128,this.setState({analyser:e})},configureAudioContext(){if(void 0===window.context){let e=AudioContext||mozAudioContext||webkitAudioContext||oAudioContext||msAudioContext;if(!e)throw"AudioContext API unavailable in current browser. Please try another!";window.context=new e,window.source=context.createMediaElementSource(this.getElement())}this.configureAudioAnalyser()},render(){return e(t).createElement("section",{className:"main"},e(t).createElement("audio",{crossOrigin:"anonymous"},e(t).createElement("source",{src:this.props.audio})),e(t).createElement(i,{analyser:this.state.analyser}))},displayName:"Audio"}),o=document.querySelector("#root");e(t).render(e(t).createElement(a,{audio:o.getAttribute("data-audio")}),o);let n=document.querySelector("audio"),l=document.querySelector(".player");n.addEventListener("loadeddata",()=>{l.querySelector(".time .length").textContent=window.getTimeCodeFromNum(n.duration);let e=n.querySelector("source").src;l.querySelector(".name").textContent=window.htmlDecode(e.substr(e.lastIndexOf("/")+1)),n.volume=.75},!1);let c=l.querySelector(".timeline");c.addEventListener("click",e=>{let t=window.getComputedStyle(c).width,r=e.offsetX/parseInt(t)*n.duration;n.currentTime=r},!1);let d=l.querySelector(".controls .volume-slider");d.addEventListener("click",e=>{let t=window.getComputedStyle(d).width,r=e.offsetX/parseInt(t);n.volume=r,l.querySelector(".controls .volume-percentage").style.width=100*r+"%"},!1),setInterval(()=>{l.querySelector(".progress").style.width=n.currentTime/n.duration*100+"%",l.querySelector(".time .current").textContent=window.getTimeCodeFromNum(n.currentTime)},500);let u=l.querySelector(".controls .toggle-play");u.addEventListener("click",()=>{n.paused?(u.classList.remove("play"),u.classList.add("pause"),n.play()):(u.classList.remove("pause"),u.classList.add("play"),n.pause())},!1),n.addEventListener("ended",()=>{u.classList.remove("pause"),u.classList.add("play")},!1),n.addEventListener("play",()=>{u.classList.remove("play"),u.classList.add("pause")},!1),l.querySelector(".volume-button").addEventListener("click",()=>{let e=l.querySelector(".volume-container .volume");n.muted=!n.muted,n.muted?(e.classList.remove("icono-volumeMedium"),e.classList.add("icono-volumeMute")):(e.classList.add("icono-volumeMedium"),e.classList.remove("icono-volumeMute"))}),window.getTimeCodeFromNum=e=>{let t=parseInt(e),r=parseInt(t/60);t-=60*r;let s=parseInt(r/60);return(r-=60*s,0===s)?`${r}:${String(t%60).padStart(2,0)}`:`${String(s).padStart(2,0)}:${r}:${String(t%60).padStart(2,0)}`},window.htmlDecode=e=>{let t=document.createElement("textarea");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue.replaceAll("%20"," ")}}();