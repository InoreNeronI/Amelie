!function(t,e,n){"use strict";var i=e.createClass({componentDidMount:function(){this.getAudioElement().addEventListener("canplay",this.configureAudioContext)},getInitialState:function(){return{analyser:null}},getAudioElement:function(){return this.getDOMNode().querySelector("audio")},configureAudioContext:function(){var t=new AudioContext||webkitAudioContext(),e=t.createAnalyser(),n=t.createMediaElementSource(this.getAudioElement());n.connect(e),e.connect(t.destination),e.fftSize=128,this.setState({analyser:e})},render:function(){return React.DOM("section",{className:"amelie"},[React.DOM("audio",{controls:"controls",autoPlay:"autoplay",src:this.props.audio}),r({analyser:this.state.analyser})])}}),r=e.createClass({componentWillReceiveProps:function(t){t.analyser&&this.analyseAudioStream(t.analyser)},getInitialState:function(){return{cursor:{x:0,y:0},frequencyData:[]}},analyseAudioStream:function o(t){(requestAnimationFrame||webkitRequestAnimationFrame)(function(){o.call(this,t)}.bind(this));var e=new Uint8Array(t.frequencyBinCount);t.getByteFrequencyData(e),this.setState({frequencyData:e,fftSize:t.fftSize})},setCursorPosition:function(t){this.setState({cursor:{x:t.clientX,y:t.clientY}})},render:function(){return React.DOM("section",{className:"visualiser",onMouseMove:this.setCursorPosition},[a({frequencyData:this.state.frequencyData,cursor:this.state.cursor,fftSize:this.state.fftSize})])}}),a=e.createClass({componentDidMount:function(){var t=n.select(this.getDOMNode()).append("svg").attr("width",200).attr("height",200).append("g");this.setState({d3:t,colours:n.scale.category20b()})},componentWillReceiveProps:function(t){0===this.state.circles.length&&t.fftSize&&this.setState({circles:this.createCircles(t.fftSize)})},createCircles:function(t){for(var e=[],n=0;t>n;n++)e.push(this.state.d3.append("circle"));return e},getInitialState:function(){return{circles:[],colours:function(){}}},renderCircles:function(t){if(0!==this.state.circles.length)for(var e=this.state.colours,n=this.props.cursor.x,i=this.props.cursor.y,r=0,a=t.length;a>r;r++)this.state.circles[r].attr("cx",n+50).attr("cy",i+50).attr("r",t[r]/7.5).style("fill",e(r))},render:function(){return this.props.frequencyData&&this.renderCircles(this.props.frequencyData),React.DOM("div",{className:"canvas-container"})}}),s=t.querySelector("amelie");e.render(i({audio:s.getAttribute("data-audio")}),s)}(window.document,window.React,window.d3);