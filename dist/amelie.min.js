!function(t,e,i){"use strict";var s=e.createClass({componentDidMount:function(){this.getAudioElement().addEventListener("canplay",this.configureAudioContext)},getInitialState:function(){return{analyser:null}},getAudioElement:function(){return this.getDOMNode().querySelector("audio")},configureAudioContext:function(){var t=new AudioContext||webkitAudioContext(),e=t.createAnalyser(),i=t.createMediaElementSource(this.getAudioElement());i.connect(e),e.connect(t.destination),e.fftSize=128,this.setState({analyser:e})},render:function(){return React.DOM("section",{className:"amelie"},[React.DOM("audio",{controls:"controls",autoPlay:"autoplay",src:this.props.audio}),n({analyser:this.state.analyser})])}}),n=e.createClass({componentWillReceiveProps:function(t){t.analyser&&this.analyseAudioStream(t.analyser)},getInitialState:function(){return{cursor:{x:0,y:0},frequencyData:[]}},analyseAudioStream:function o(t){(requestAnimationFrame||webkitRequestAnimationFrame)(function(){o.call(this,t)}.bind(this));var e=new Uint8Array(t.frequencyBinCount);t.getByteFrequencyData(e),this.setState({frequencyData:e,fftSize:t.fftSize})},setCursorPosition:function(t){this.setState({cursor:{x:t.clientX,y:t.clientY}})},render:function(){return React.DOM("section",{className:"visualiser",onMouseMove:this.setCursorPosition},[a({frequencyData:this.state.frequencyData,cursor:this.state.cursor,fftSize:this.state.fftSize})])}}),a=e.createClass({componentDidMount:function(){var t=i.select(this.getDOMNode()).append("svg").attr("width",this.state.size[0]).attr("height",this.state.size[1]).append("g");this.getDOMNode().style.width=this.state.size[0]+"px",this.getDOMNode().style.height=this.state.size[1]+"px",this.setState({d3:t,colours:i.scale.category20b()})},componentWillReceiveProps:function(t){0===this.state.circles.length&&t.fftSize&&this.setState({circles:this.createCircles(t.fftSize)})},createCircles:function(t){for(var e=[],i=0;t>i;i++)e.push(this.state.d3.append("circle"));return e},getInitialState:function(){return{circles:[],colours:function(){},size:[250,250]}},renderCircles:function(t){if(0!==this.state.circles.length)for(var e=this.state.colours,i=0,s=t.length;s>i;i++)this.state.circles[i].attr("cx",this.state.size[0]-60).attr("cy",this.state.size[1]-60).attr("r",t[i]/5).style("fill",e(i))},positionDOMElement:function(t){this.getDOMNode().style.left=t.x-this.state.size[0]/2+"px",this.getDOMNode().style.top=t.y-this.state.size[1]/2+"px"},render:function(){return this.props.frequencyData&&(this.renderCircles(this.props.frequencyData),this.state.d3&&this.positionDOMElement(this.props.cursor)),React.DOM("div",{className:"canvas-container"})}}),r=t.querySelector("amelie");e.render(s({audio:r.getAttribute("data-audio")}),r)}(window.document,window.React,window.d3);